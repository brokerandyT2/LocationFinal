<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:graphics="http://schemas.microsoft.com/dotnet/2021/maui/graphics"
             x:Class="Location.Photography.Maui.Controls.SunPathVisualization"
             x:Name="SunPathControl">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header with Current Position Info -->
        <Frame Grid.Row="0" BackgroundColor="#E3F2FD" CornerRadius="8" Padding="10" Margin="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <StackLayout Grid.Column="0">
                    <Label Text="Current Position" FontSize="12" FontAttributes="Bold" TextColor="#1976D2"/>
                    <Label Text="{Binding CurrentAzimuth, Converter={StaticResource DoubleToAzimuthStringConverter}}" FontSize="14"/>
                    <Label Text="{Binding CurrentElevation, Converter={StaticResource DoubleToElevationStringConverter}}" FontSize="14"/>
                </StackLayout>
                <StackLayout Grid.Column="1">
                    <Label Text="Sun Status" FontSize="12" FontAttributes="Bold" TextColor="#1976D2"/>
                    <Label Text="{Binding IsSunUp, Converter={StaticResource BoolToSunStatusConverter}}" FontSize="14"/>
                </StackLayout>
                <StackLayout Grid.Column="2">
                    <Label Text="Date" FontSize="12" FontAttributes="Bold" TextColor="#1976D2"/>
                    <Label Text="{Binding SelectedDate, StringFormat='{0:MMM dd, yyyy}'}" FontSize="14"/>
                </StackLayout>
            </Grid>
        </Frame>

        <!-- Main Sun Path Canvas -->
        <Frame Grid.Row="1" BackgroundColor="White" CornerRadius="8" Padding="10" Margin="5" HasShadow="True">
            <Grid>
                <!-- Canvas for drawing sun path -->
                <GraphicsView x:Name="SunPathCanvas" 
                             HeightRequest="300"
                             WidthRequest="300"
                             BackgroundColor="White">
                    <GraphicsView.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnSunPathTapped"/>
                    </GraphicsView.GestureRecognizers>
                </GraphicsView>

                <!-- Overlay labels for cardinal directions -->
                <Grid InputTransparent="True">
                    <Label Text="N" FontSize="16" FontAttributes="Bold" TextColor="#666" 
                           HorizontalOptions="Center" VerticalOptions="Start" Margin="0,5,0,0"/>
                    <Label Text="S" FontSize="16" FontAttributes="Bold" TextColor="#666" 
                           HorizontalOptions="Center" VerticalOptions="End" Margin="0,0,0,5"/>
                    <Label Text="E" FontSize="16" FontAttributes="Bold" TextColor="#666" 
                           HorizontalOptions="End" VerticalOptions="Center" Margin="0,0,5,0"/>
                    <Label Text="W" FontSize="16" FontAttributes="Bold" TextColor="#666" 
                           HorizontalOptions="Start" VerticalOptions="Center" Margin="5,0,0,0"/>
                </Grid>

                <!-- Legend overlay -->
                <Frame BackgroundColor="#F5F5F5" CornerRadius="5" Padding="8" 
                       HorizontalOptions="End" VerticalOptions="Start" Margin="10"
                       IsVisible="{Binding ShowLegend}">
                    <StackLayout Spacing="3">
                        <Label Text="Legend" FontSize="12" FontAttributes="Bold"/>
                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <BoxView Color="#FFA500" WidthRequest="15" HeightRequest="3" VerticalOptions="Center"/>
                            <Label Text="Sun Path" FontSize="10"/>
                        </StackLayout>
                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <Ellipse Fill="#FF6B6B" WidthRequest="8" HeightRequest="8" VerticalOptions="Center"/>
                            <Label Text="Current Position" FontSize="10"/>
                        </StackLayout>
                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <Ellipse Fill="#4ECDC4" WidthRequest="6" HeightRequest="6" VerticalOptions="Center"/>
                            <Label Text="Hourly Points" FontSize="10"/>
                        </StackLayout>
                        <StackLayout Orientation="Horizontal" Spacing="5">
                            <BoxView Color="#FFD93D" WidthRequest="15" HeightRequest="3" VerticalOptions="Center"/>
                            <Label Text="Golden Hour" FontSize="10"/>
                        </StackLayout>
                    </StackLayout>
                </Frame>
            </Grid>
        </Frame>

        <!-- Bottom Controls and Info -->
        <Grid Grid.Row="2" Margin="5">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Time Selection Slider -->
            <Frame Grid.Row="0" BackgroundColor="#FFF8E1" CornerRadius="8" Padding="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Label Grid.Row="0" Text="Select Time to View Sun Position" FontSize="14" FontAttributes="Bold" TextColor="#F57F17"/>

                    <Slider Grid.Row="1" x:Name="TimeSlider"
                            Minimum="0" Maximum="1440" Value="{Binding SelectedTimeMinutes}"
                            ValueChanged="OnTimeSliderChanged"
                            Margin="0,5,0,0"/>

                    <Grid Grid.Row="2" Margin="0,5,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Label Grid.Column="0" Text="00:00" FontSize="12" TextColor="#F57F17"/>
                        <Label Grid.Column="1" Text="{Binding SelectedTimeDisplay}" FontSize="12" TextColor="#F57F17" HorizontalTextAlignment="Center"/>
                        <Label Grid.Column="2" Text="24:00" FontSize="12" TextColor="#F57F17" HorizontalTextAlignment="End"/>
                    </Grid>
                </Grid>
            </Frame>

            <!-- Control Buttons -->
            <Grid Grid.Row="1" Margin="0,10,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Text="🌅 Sunrise" FontSize="12" 
                        Command="{Binding GoToSunriseCommand}"
                        BackgroundColor="#FF7043" TextColor="White"/>

                <Button Grid.Column="1" Text="☀️ Noon" FontSize="12"
                        Command="{Binding GoToSolarNoonCommand}"
                        BackgroundColor="#FFA726" TextColor="White"/>

                <Button Grid.Column="2" Text="🌅 Sunset" FontSize="12"
                        Command="{Binding GoToSunsetCommand}"
                        BackgroundColor="#FF7043" TextColor="White"/>

                <Button Grid.Column="3" Text="🕐 Now" FontSize="12"
                        Command="{Binding GoToCurrentTimeCommand}"
                        BackgroundColor="#42A5F5" TextColor="White"/>
            </Grid>
        </Grid>

        <!-- Selected Point Info Popup -->
        <Frame x:Name="PointInfoPopup" 
               BackgroundColor="#263238" 
               CornerRadius="8" 
               Padding="10"
               IsVisible="False"
               HorizontalOptions="Center" 
               VerticalOptions="Center"
               HasShadow="True">
            <StackLayout Spacing="5">
                <Label x:Name="PopupTimeLabel" Text="" FontSize="14" FontAttributes="Bold" TextColor="White"/>
                <Label x:Name="PopupAzimuthLabel" Text="" FontSize="12" TextColor="#B0BEC5"/>
                <Label x:Name="PopupElevationLabel" Text="" FontSize="12" TextColor="#B0BEC5"/>
                <Label x:Name="PopupLightQualityLabel" Text="" FontSize="12" TextColor="#81C784"/>
                <Button Text="Close" FontSize="12" BackgroundColor="#455A64" TextColor="White"
                        Clicked="OnClosePopup" Margin="0,5,0,0"/>
            </StackLayout>
        </Frame>
    </Grid>
</ContentView>